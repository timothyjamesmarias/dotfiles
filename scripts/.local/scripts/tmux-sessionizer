#!/usr/bin/env bash

# Cache configuration
CACHE_FILE="$HOME/.cache/tmux-sessionizer-dirs"
CACHE_TTL=3600  # 1 hour in seconds

# Build or refresh cache
if [[ ! -f "$CACHE_FILE" ]] || [[ $(find "$CACHE_FILE" -mmin +60 2>/dev/null) ]]; then
  find ~ ~/projects ~/notes -mindepth 1 -maxdepth 2 -type d 2>/dev/null > "$CACHE_FILE"
fi

# Choose session directory from cache
session=$(cat "$CACHE_FILE" | fzf --height 40% --border rounded --prompt 'ðŸ“ ' --pointer 'â–¶')
session_name=$(basename "$session" | tr . _)

# Check if tmux is running
if ! tmux has-session -t "$session_name" 2>/dev/null; then
  # Start tmux if it's not already running
  tmux new-session -s "$session_name" -c "$session" -d "exec /bin/zsh --login"
fi

# Attach to tmux session
tmux switch-client -t "$session_name"
